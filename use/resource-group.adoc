---
sidebar: sidebar 
permalink: use/resource-group.html 
keywords: disaster recovery, bluexp disaster recovery, failover, failback, replicate, fail over, fail back, vmware, vcenter, replication plan, protection, disaster, recovery, virtual machines, vm 
summary: NetApp Disaster Recovery是一种基于云的灾难恢复服务，可自动执行灾难恢复工作流程。添加 vCenter 站点后，您就可以创建灾难恢复或复制计划了。 
---
= 在NetApp Disaster Recovery中创建资源组以组织虚拟机
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/use/


[role="lead"]
添加 vCenter 站点后，您可以创建资源组，以虚拟机或数据存储区作为单个单元来保护虚拟机。资源组使您能够将一组依赖的虚拟机组织成满足您要求的逻辑组。例如，您可以将与一个应用程序关联的虚拟机分组，也可以将具有相似层的应用程序分组。再举一个例子，组可以包含可以在恢复时运行的延迟启动命令。

*所需的NetApp Console角色* 组织管理员、文件夹或项目管理员、灾难恢复管理员或灾难恢复应用程序管理员角色。

link:../reference/dr-reference-roles.html["了解NetApp Disaster Recovery中的用户角色和权限"] 。https://docs.netapp.com/us-en/bluexp-setup-admin/reference-iam-predefined-roles.html["了解所有服务的NetApp Console访问角色"^] 。

*关于此任务*

您可以对虚拟机本身或数据存储中的虚拟机进行分组。

您可以使用以下方法创建资源组：

* 从资源组选项
* 当您创建灾难恢复或_复制计划_时。如果源 vCenter 集群托管了大量虚拟机，则在创建复制计划时创建资源组可能会更轻松。有关在创建复制计划时创建资源组的说明，请参阅link:drplan-create.html["创建复制计划"]。



TIP: 每个资源组可以包含一个或多个虚拟机或数据存储区。虚拟机将根据您在复制计划中包含它们的顺序启动。您可以通过在资源组列表中上下拖动虚拟机或数据存储来更改顺序。

.关于资源组
资源组允许您将虚拟机或数据存储组合为一个单元。

例如，销售点应用程序可能会使用多个虚拟机来存储数据库、业务逻辑和店面。您可以使用一个资源组管理所有这些虚拟机。设置资源组以应用虚拟机启动顺序、网络连接和应用程序所需的所有虚拟机的恢复的复制计划规则。

.它是如何工作的？
NetApp Disaster Recovery通过复制资源组中托管虚拟机的底层ONTAP卷和 LUN 来保护虚拟机。为此，系统向 vCenter 查询资源组中托管虚拟机的每个数据存储的名称。然后， NetApp Disaster Recovery会识别托管该数据存储的源ONTAP卷或 LUN。所有保护均使用SnapMirror复制在ONTAP卷级别执行。

如果资源组中的虚拟机托管在不同的数据存储上， NetApp Disaster Recovery将使用以下方法之一来创建ONTAP卷或 LUN 的数据一致快照。

[cols="30,65a"]
|===
| FlexVol卷的相对位置 | 快照副本流程 


| 多个数据存储 - 同一 SVM 中的FlexVol卷  a| 
* ONTAP一致性组已创建
* 拍摄的一致性组快照
* 执行卷范围的SnapMirror复制




| 多个数据存储 - *多个 SVM* 中的FlexVol卷  a| 
* ONTAP API： `cg_start` 。使所有卷静止以便可以拍摄快照，并启动所有资源组卷的卷范围快照。
* ONTAP API： `cg_end` 。恢复所有卷上的 I/O，并在拍摄快照后启用卷范围的SnapMirror复制。


|===
创建资源组时，请考虑以下问题：

* 在将数据存储区添加到资源组之前，请先启动虚拟机的手动发现或计划发现。这可确保虚拟机被发现并列在资源组中。如果您不启动手动发现，虚拟机可能不会列在资源组中。
* 确保数据存储区中至少有一个虚拟机。如果数据存储区中没有虚拟机，灾难恢复将无法发现该数据存储区。
* 单个数据存储区不应托管受多个复制计划保护的虚拟机。
* 不要在同一数据存储上托管受保护和不受保护的虚拟机。如果受保护的虚拟机和不受保护的虚拟机托管在同一数据存储上，则可能会出现以下问题：
+
** 由于NetApp Disaster Recovery使用SnapMirror并且系统复制整个ONTAP卷，因此该卷的已用容量用于许可考虑。在这种情况下，受保护和不受保护的虚拟机所消耗的卷空间都将包含在此计算中。
** 如果资源组及其关联的数据存储库需要故障转移到灾难恢复站点，则任何未受保护的虚拟机（不属于资源组但托管在ONTAP卷上的虚拟机）将在故障转移过程中不再存在于源站点上，从而导致源站点上未受保护的虚拟机发生故障。此外， NetApp Disaster Recovery不会在故障转移 vCenter 站点启动那些未受保护的虚拟机。


* 要保护虚拟机，必须将其包含在资源组中。


*最佳实践*：在部署NetApp Disaster Recovery之前组织您的虚拟机，以最大限度地减少“数据存储蔓延”。将需要保护的虚拟机放置在数据存储的子集上，将不需要保护的虚拟机放置在不同的数据存储子集上。确保任何给定数据存储上的虚拟机不受不同的复制计划的保护。

.步骤
. 登录 https://console.netapp.com/["NetApp Console"^]。
. 从NetApp Console左侧导航中，选择 *保护* > *灾难恢复*。
. 从NetApp Disaster Recovery菜单中，选择 *资源组*。
. 选择“*添加*”。
. 输入资源组的名称。
. 选择虚拟机所在的源 vCenter 集群。
. 根据您的搜索方式选择*虚拟机*或*数据存储*。
. 选择“添加资源组”选项卡。系统列出所选 vCenter 集群中的所有数据存储区或虚拟机。如果您选择了“*数据存储*”，系统将列出所选 vCenter 群集中的所有数据存储。如果您选择了“*虚拟机*”，系统将列出所选 vCenter 集群中的所有虚拟机。
. 在添加资源组页面的左侧，选择要保护的虚拟机。
+
image:dr-resource-groups-add.png["显示“添加资源组”页面的屏幕截图"]

+
image:dr-resource-groups-datastores-add.png["显示“添加资源组”页面的屏幕截图"]

. 或者，通过将每个虚拟机在列表中向上或向下拖动来更改右侧虚拟机的顺序。虚拟机将根据您包含它们的顺序启动。
. 选择“*添加*”。

