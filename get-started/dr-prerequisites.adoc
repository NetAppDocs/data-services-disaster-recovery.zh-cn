---
sidebar: sidebar 
permalink: get-started/dr-prerequisites.html 
keywords: what are disaster recovery requirements, disaster recovery prerequisites, bluexp, disaster recovery 
summary: 在使用NetApp Disaster Recovery之前，请确保您的环境满足ONTAP存储、VMware vCenter 集群和NetApp Console的要求。 
---
= NetApp Disaster Recovery前提条件
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/get-started/


[role="lead"]
在使用NetApp Disaster Recovery之前，请确保您的环境满足ONTAP存储、VMware vCenter 集群和NetApp Console的要求。



== 软件版本

[cols="35,55a"]
|===
| 组件 | 最低版本 


| Amazon FSx for NetApp ONTAP  a| 
最新可用版本



| 使用Google Cloud NetApp Volumes 的Google Cloud VMware Engine  a| 
最新可用版本



| ONTAP 软件  a| 
ONTAP 9.10.0 或更高版本



| 适用于 AWS 的 VMware Cloud  a| 
最新可用版本



| VMware 本地 vCenter  a| 
7.0u3 或更高版本

|===


== Google Cloud 的先决条件和注意事项

使用 Google Google Cloud NetApp Volumes VMware Engine 上进行灾难恢复时，请确保配置正确的权限并遵守以下注意事项。

* 请联系 Google SRE 团队，将以下服务添加到允许列表中：
+
** 同步 API，用于将快照从本地存储传输到Google Cloud NetApp Volumes。
** Google 与 VMware 引擎合作的项目，用于创建、挂载和卸载数据存储。


* 你必须link:https://docs.google.com/forms/d/1zuaHu437MNpUf8i5oByK-OTLWXcNIg0es9t036riYRc/viewform?edit_requested=true["提交请求，将您的卷添加到混合复制允许列表中"^]。
* 注意link:https://docs.cloud.google.com/netapp/volumes/docs/quotas["Google Cloud NetApp Volumes配额和限制"^]。
* 一个复制计划只能添加一个卷或数据存储。
* 复习link:../release-notes/dr-limitations.html#limitations-with-google-cloud-netapp-volumes["限制"]。


故障转移注意事项

* 仅使用最新快照支持故障转移。如果需要，可以在故障转移期间创建新快照（即必须禁用选择性快照选项）。
* 故障转移后无法创建新的快照。
* 故障转移后无法保留和协调快照。


**故障恢复考虑因素**

* 只有在启用选择性快照选项的情况下才能进行故障恢复。您无法通过创建新快照来执行故障恢复。
* 如果删除本地存储和Google Cloud NetApp Volumes存储集群之间的集群对等连接，则必须手动从本地集群中清除集群和存储 VM 对等连接条目。有关详细信息，请参阅 link:https://docs.netapp.com/us-en/ontap-cli/vserver-peer-delete.html["删除虚拟服务器对等关系"^]。




=== Google Cloud 权限

应为 Google Cloud 中的服务主体分配以下角色或等效权限：

* link:https://docs.cloud.google.com/compute/docs/access/iam["计算管理员角色"^]
* link:https://docs.netapp.com/us-en/console-setup-admin/reference-permissions-gcp.html["NetApp Console的 Google Cloud 权限"^]
* link:https://docs.cloud.google.com/iam/docs/roles-permissions/netapp["Google Cloud NetApp Volumes管理员"]
* link:https://docs.cloud.google.com/vmware-engine/docs/iam#vmware-engine-roles["VMware Engine 服务管理员"^]




=== NetApp Console权限

NetApp Console用户必须具有以下角色：

* link:https://docs.netapp.com/us-en/console-setup-admin/reference-iam-gcnv-roles.html["Google Cloud NetApp Volumes管理员"^]
* link:https://docs.netapp.com/us-en/console-setup-admin/reference-iam-predefined-roles.html#data-service-roles["SnapCenter管理员"^]
* link:https://docs.netapp.com/us-en/console-setup-admin/reference-iam-disaster-rec-roles.html["灾难恢复故障转移管理员"^]




== ONTAP存储前提条件

这些先决条件适用于ONTAP或 Amazon FSX for NetApp ONTAP实例。

* 源集群和目标集群必须具有对等关系。
* 承载灾难恢复卷的 SVM 必须存在于目标集群上。
* 源 SVM 和目标 SVM 必须具有对等关系。
* 如果使用Amazon FSx for NetApp ONTAP进行部署，则适用以下先决条件：
+
** 您的 VPC 中必须存在用于托管 VMware DR 数据存储区的Amazon FSx for NetApp ONTAP实例。首先，请参阅link:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/getting-started-step1.html["Amazon FSx for ONTAP文档"^]。






== VMware vCenter 集群先决条件

这些先决条件适用于本地 vCenter 集群和 VMware Cloud for AWS 软件定义数据中心 (SDDC)。

* 审查link:../reference/vcenter-privileges.html["vCenter 权限"]NetApp Disaster Recovery所必需的。
* 您希望NetApp Disaster Recovery管理的所有 VMware 集群都使用ONTAP卷来托管您想要保护的任何虚拟机。
* NetApp Disaster Recovery要管理的所有 VMware 数据存储库都必须使用以下协议之一：
+
** NFS
** 使用 iSCSI 或 FC 协议的 VMFS


* VMware vSphere 版本 7.0 Update 3 (7.0v3) 或更高版本
* 如果您使用的是 VMware Cloud SDDC，则这些先决条件适用。
+
** 在 VMware Cloud Console 中，使用管理员和 NSX Cloud 管理员的服务角色。还可以使用组织所有者作为组织角色。参考 https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/vmware-cloud-ontap.html["将 VMware Cloud Foundations 与 AWS FSx for NetApp ONTAP文档结合使用"^]。
** 将 VMware Cloud SDDC 与Amazon FSx for NetApp ONTAP实例链接。参考 https://vmc.techzone.vmware.com/fsx-guide#overview["VMware Cloud on AWS 与Amazon FSx for NetApp ONTAP集成部署信息"^]。






== NetApp Console前提条件



=== 开始使用NetApp Console

如果你还没有这样做的话， https://docs.netapp.com/us-en/console-setup-admin/task-sign-up-saas.html["注册NetApp Console并创建组织"^] 。



=== 收集ONTAP和 VMware 的凭证

* 必须将Amazon FSx for ONTAP和 AWS 凭证添加到管理NetApp Disaster Recovery的NetApp Console项目中的系统中。
* NetApp Disaster Recovery需要 vCenter 凭据。在NetApp Disaster Recovery中添加站点时，您需要输入 vCenter 凭据。
+
有关所需 vCenter 权限的列表，请参阅link:../reference/vcenter-privileges.html["NetApp Disaster Recovery所需的 vCenter 权限"]。有关如何添加站点的说明，请参阅link:../use/sites-add.html["添加站点"]。





=== 创建NetApp Console代理

控制台代理是一个软件组件，它使控制台能够与您的ONTAP存储和 VMware vCenter 集群进行通信。它是灾难恢复正常运行所必需的。代理程序驻留在您的私有网络（本地数据中心或云 VPC）中，并与您的ONTAP存储实例以及任何其他服务器和应用程序组件进行通信。对于灾难恢复，这是对您管理的 vCenter 集群的访问。

必须在NetApp Console中设置控制台代理。当您使用该代理时，它将包含适合灾难恢复服务的功能。

* NetApp Disaster Recovery仅适用于标准模式代理部署。看 https://docs.netapp.com/us-en/console-setup-admin/task-quick-start-standard-mode.html["在标准模式下开始使用NetApp Console"^]。
* 确保源和目标 vCenter 集群都使用相同的 Console 代理。
* 所需的控制台代理类型：
+
** *本地到本地灾难恢复*：在灾难恢复站点中安装本地 Console 代理。使用此方法，主站点的故障不会阻止服务在 DR 站点重新启动虚拟资源。请参阅 https://docs.netapp.com/us-en/console-setup-admin/task-install-connector-on-prem.html["在本地安装并设置控制台代理"^]。
+
灾难恢复还支持使用多个本地配置的控制台代理。在这种情况下，控制台代理会将操作定向到 vCenter 和ONTAP阵列集群，源和目标各自拥有自己的控制台代理。建议使用多个控制台代理，以减少延迟并缩短控制台代理或站点发生故障时的恢复时间。

** *本地到 AWS*：在您的 AWS VPC 中安装 AWS 的控制台代理。参考 https://docs.netapp.com/us-en/console-setup-admin/concept-install-options-aws.html["AWS 中的控制台代理安装选项"^]。
+

TIP: 对于本地到本地，请使用本地控制台代理。对于本地到 AWS，使用 AWS 控制台代理，它可以访问源本地 vCenter 和目标本地 vCenter。

** 已安装的控制台代理必须能够访问灾难恢复将要管理的任何 VMware vCenter 集群实例和由这些 vCenter 集群管理的 ESXi 主机。


* 所有由NetApp Disaster Recovery管理的ONTAP阵列都必须添加到NetApp Console项目内用于管理NetApp Disaster Recovery的任何系统中。
+
看 https://docs.netapp.com/us-en/storage-management-ontap-onprem/task-discovering-ontap.html["发现本地ONTAP集群"^]。

* 有关为NetApp Disaster Recovery设置智能代理的信息，请参阅link:../get-started/dr-setup.html["为NetApp Disaster Recovery设置基础架构"]。




== 工作负载先决条件

为了确保应用程序一致性流程成功，请满足以下先决条件：

* 确保 VMware 工具（或 Open VM 工具）正在要保护的虚拟机上运行。
* 对于运行 Microsoft SQL Server、Oracle 数据库或两者的 Windows 虚拟机，必须启用数据库的 VSS 写入器。
* 在 Linux 操作系统上运行的 Oracle 数据库必须为 Oracle 数据库 SYSDBA 角色启用操作系统用户身份验证。




== 更多信息

* xref:../reference/vcenter-privileges.html[所需 vCenter 权限]
* xref:../reference/evs-deploy-guide-config-prereqs.html[Amazon EVS 与NetApp Disaster Recovery的先决条件]

